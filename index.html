<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heritage Repository - Consent-Based Digital Archive</title>
    <meta
      name="description"
      content="Safeguarding Naga Heritage â€” Respectfully, Authentically, Together. A consent-based, tiered digital archive for traditional knowledge."
    />
    <meta name="author" content="Heritage Repository" />

    <meta
      property="og:title"
      content="Heritage Repository - Consent-Based Digital Archive"
    />
    <meta
      property="og:description"
      content="Safeguarding Naga Heritage â€” Respectfully, Authentically, Together."
    />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!-- Footer Chat Toggle Button -->
    <div id="chat-toggle" style="position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #1890ff, #096dd9); color: white; padding: 12px 20px; border-radius: 30px; cursor: pointer; z-index: 9999; box-shadow: 0 4px 15px rgba(0,0,0,0.15); transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; font-weight: 500; font-size: 0.95rem;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Chat with us</span>
      <div style="width: 20px; height: 20px; background: #ff4d4f; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; box-shadow: 0 1px 3px rgba(0,0,0,0.2);">1</div>
    </div>

    <!-- Modern Chat Container -->
    <div id="chat-container" style="position: fixed; bottom: 80px; right: 20px; width: 380px; max-width: calc(100% - 40px); height: 600px; max-height: 80vh; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); display: flex; flex-direction: column; z-index: 1000; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); transform: translateY(20px); opacity: 0; pointer-events: none; overflow: hidden;">
      <div style="background: linear-gradient(135deg, #1890ff, #096dd9); color: white; padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600; line-height: 1.3;">Chat Support</h3>
            <p style="margin: 0; font-size: 0.8rem; opacity: 0.9; font-weight: 400;">We're here to help you!</p>
          </div>
        </div>
        <div>
          <button id="minimize-chat" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; margin-right: 8px; transition: all 0.2s ease;">âˆ’</button>
          <button id="close-chat" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease;">Ã—</button>
        </div>
      </div>
      <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 20px; background: #f8fafc; scrollbar-width: thin; scrollbar-color: #d1d5db #f3f4f6; background-image: radial-gradient(#e5e7eb 1px, transparent 1px); background-size: 20px 20px;">
        <!-- Messages will be inserted here -->
      </div>
      <div style="padding: 16px; background: white; border-top: 1px solid #f0f0f0; box-shadow: 0 -2px 10px rgba(0,0,0,0.03);">
        <div style="display: flex; gap: 8px;">
          <input 
            type="text" 
            id="chat-input" 
            style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; font-size: 0.95rem;" 
            placeholder="Type a message..."
            autocomplete="off"
          >
          <button id="send-btn" style="background: #1890ff; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div style="margin-top: 10px; text-align: center;">
          <button id="end-chat-btn" style="background: #ff4d4f; color: white; border: none; padding: 6px 12px; border-radius: 15px; font-size: 0.85rem; cursor: pointer; display: inline-flex; align-items: center; gap: 4px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            End Chat
          </button>
        </div>
      </div>
    </div>

    <!-- Chat Storage Script -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // State management
        const chatState = {
          isVisible: false,
          isMinimized: false,
          messages: [],
          unreadCount: 0,
          isTyping: false
        };

        // Get all chat elements
        const chatToggle = document.getElementById('chat-toggle');
        const chatContainer = document.getElementById('chat-container');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const chatMessages = document.getElementById('chat-messages');
        const closeChatBtn = document.getElementById('close-chat');
        const minimizeChatBtn = document.getElementById('minimize-chat');
        const endChatBtn = document.getElementById('end-chat-btn');
        const unreadBadge = chatToggle?.querySelector('div');

        // Toggle chat visibility
        function toggleChat() {
          // Force show the chat container if it's hidden
          if (chatContainer.style.opacity === '0' || chatContainer.style.display === 'none') {
            chatState.isVisible = true;
            chatContainer.style.display = 'flex';
            chatContainer.style.opacity = '1';
            chatContainer.style.transform = 'translateY(0)';
            chatContainer.style.pointerEvents = 'auto';
            if (chatInput) chatInput.focus();
          } else {
            chatState.isVisible = !chatState.isVisible;
            updateChatUI();
          }
          
          if (chatState.isVisible) {
            if (chatInput) chatInput.focus();
            // Reset unread count when opening chat
            if (unreadBadge) {
              chatState.unreadCount = 0;
              unreadBadge.style.display = 'none';
            }
          }
        }

        // Update chat UI based on state
        function updateChatUI() {
          if (chatState.isVisible) {
            chatContainer.style.display = 'flex';
            chatContainer.style.transform = 'translateY(0)';
            chatContainer.style.opacity = '1';
            chatContainer.style.pointerEvents = 'auto';
            // Ensure the chat is above other elements
            chatContainer.style.zIndex = '1000';
          } else {
            chatContainer.style.transform = 'translateY(20px)';
            chatContainer.style.opacity = '0';
            chatContainer.style.pointerEvents = 'none';
            // Keep the element in the document flow but hidden
            chatContainer.style.display = 'none';
          }
          
          if (chatState.isMinimized) {
            chatContainer.style.height = '60px';
            chatContainer.querySelector('#chat-messages').style.display = 'none';
            chatContainer.querySelector('div:last-child').style.display = 'none';
          } else {
            chatContainer.style.height = '600px';
            chatContainer.querySelector('#chat-messages').style.display = 'block';
            chatContainer.querySelector('div:last-child').style.display = 'block';
            scrollToBottom();
          }
        }

        // Close chat
        function closeChat() {
          chatState.isVisible = false;
          updateChatUI();
        }

        // Toggle minimize
        function toggleMinimize() {
          chatState.isMinimized = !chatState.isMinimized;
          updateChatUI();
        }

        // Add a new message to the chat
        function addMessage(sender, message, isSystem = false) {
          const messageElement = document.createElement('div');
          messageElement.className = `message ${sender === 'user' ? 'user-message' : 'system-message'}`;
          
          const timeString = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          
          messageElement.innerHTML = `
            <div class="message-content">${message}</div>
            <div class="message-time">${timeString}</div>
          `;
          
          chatMessages.appendChild(messageElement);
          scrollToBottom();
          
          // Add to message history
          chatState.messages.push({ sender, message, time: timeString });
          
          // Update unread count if chat is closed or minimized
          if ((!chatState.isVisible || chatState.isMinimized) && sender === 'system') {
            chatState.unreadCount++;
            if (unreadBadge) {
              unreadBadge.textContent = chatState.unreadCount > 9 ? '9+' : chatState.unreadCount;
              unreadBadge.style.display = 'flex';
            }
          }
        }

        // Show typing indicator
        function showTypingIndicator() {
          if (chatState.isTyping) return;
          
          chatState.isTyping = true;
          const typingElement = document.createElement('div');
          typingElement.id = 'typing-indicator';
          typingElement.className = 'typing-indicator';
          typingElement.innerHTML = `
            <div></div>
            <div></div>
            <div></div>
          `;
          chatMessages.appendChild(typingElement);
          scrollToBottom();
        }

        // Hide typing indicator
        function hideTypingIndicator() {
          chatState.isTyping = false;
          const typingElement = document.getElementById('typing-indicator');
          if (typingElement) {
            typingElement.remove();
          }
        }

        // Generate bot response
        function generateBotResponse(userMessage) {
          const responses = [
            "I understand your concern. Let me help you with that.",
            "Thanks for reaching out! How can I assist you today?",
            "I'll look into this and get back to you shortly.",
            "That's a great question! Let me find the best solution for you.",
            "I'm here to help. Could you provide more details?"
          ];
          
          // Simple response logic - can be enhanced
          if (userMessage.toLowerCase().includes('help')) {
            return "I'm here to help! What do you need assistance with?";
          } else if (userMessage.toLowerCase().includes('thank')) {
            return "You're welcome! Is there anything else I can help you with?";
          } else if (userMessage.toLowerCase().includes('hello') || userMessage.toLowerCase().includes('hi')) {
            return "Hello! How can I assist you today?";
          }
          
          return responses[Math.floor(Math.random() * responses.length)];
        }

        // Send message
        function sendMessage() {
          const message = chatInput.value.trim();
          if (!message || chatState.isTyping) return;
          
          // Add user message
          addMessage('user', message);
          chatInput.value = '';
          
          // Show typing indicator
          showTypingIndicator();
          
          // Simulate bot response after a short delay
          setTimeout(() => {
            hideTypingIndicator();
            const botResponse = generateBotResponse(message);
            addMessage('system', botResponse, true);
          }, 1000 + Math.random() * 1000); // Random delay between 1-2 seconds
        }

        // Scroll chat to bottom
        function scrollToBottom() {
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to ensure chat is properly displayed
        function ensureChatVisible() {
          chatState.isVisible = true;
          chatContainer.style.display = 'flex';
          chatContainer.style.opacity = '1';
          chatContainer.style.transform = 'translateY(0)';
          chatContainer.style.pointerEvents = 'auto';
          chatContainer.style.zIndex = '1000';
          if (chatInput) chatInput.focus();
        }

        // Initialize chat
        function initChat() {
          // Clear any existing event listeners to prevent duplicates
          const newChatToggle = chatToggle.cloneNode(true);
          chatToggle.parentNode.replaceChild(newChatToggle, chatToggle);
          
          const newCloseBtn = closeChatBtn.cloneNode(true);
          closeChatBtn.parentNode.replaceChild(newCloseBtn, closeChatBtn);
          
          // Add welcome message if no messages exist
          if (chatState.messages.length === 0) {
            addMessage('system', 'Hello! How can I help you today?', true);
          }
          
          // Set up event listeners with new elements
          if (newChatToggle) newChatToggle.addEventListener('click', toggleChat);
          if (newCloseBtn) newCloseBtn.addEventListener('click', closeChat);
          if (minimizeChatBtn) {
            const newMinBtn = minimizeChatBtn.cloneNode(true);
            minimizeChatBtn.parentNode.replaceChild(newMinBtn, minimizeChatBtn);
            newMinBtn.addEventListener('click', toggleMinimize);
          }
          
          if (sendBtn) {
            const newSendBtn = sendBtn.cloneNode(true);
            sendBtn.parentNode.replaceChild(newSendBtn, sendBtn);
            newSendBtn.addEventListener('click', sendMessage);
          }
          
          if (endChatBtn) {
            const newEndBtn = endChatBtn.cloneNode(true);
            endChatBtn.parentNode.replaceChild(newEndBtn, endChatBtn);
            newEndBtn.addEventListener('click', closeChat);
          }
          
          if (chatInput) {
            const newChatInput = chatInput.cloneNode(true);
            chatInput.parentNode.replaceChild(newChatInput, chatInput);
            
            newChatInput.addEventListener('keypress', (e) => {
              if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
              }
            });
            
            // Focus the new input if chat is visible
            if (chatState.isVisible) {
              setTimeout(() => newChatInput.focus(), 100);
            }
          }
          
          // Initial UI update and ensure chat is visible
          ensureChatVisible();
          
          // Add a small delay to ensure everything is properly initialized
          setTimeout(() => {
            ensureChatVisible();
            if (chatInput) chatInput.focus();
          }, 100);
        }

        // Start the chat
      try {
        initChat();
      } catch (error) {
        console.error('Error initializing chat:', error);
        // Attempt to reinitialize after a short delay if there's an error
        setTimeout(initChat, 500);
      }
      });
    </script>
    <style>
      /* Chat Styles */
      .message {
        margin-bottom: 12px;
        padding: 10px 15px;
        border-radius: 18px;
        max-width: 80%;
        position: relative;
        line-height: 1.4;
        animation: fadeIn 0.3s ease;
      }

      .user-message {
        background: #1890ff;
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px;
      }

      .system-message {
        background: #f0f2f5;
        color: #1f1f1f;
        margin-right: auto;
        border-bottom-left-radius: 4px;
      }

      .message-content {
        word-wrap: break-word;
      }

      .message-time {
        font-size: 0.7rem;
        opacity: 0.7;
        margin-top: 4px;
        text-align: right;
      }

      .typing-indicator {
        display: flex;
        padding: 10px 15px;
        margin-bottom: 12px;
        background: #f0f2f5;
        border-radius: 18px;
        width: fit-content;
        max-width: 80%;
        border-bottom-left-radius: 4px;
      }
      
      .typing-indicator div {
        width: 8px;
        height: 8px;
        margin: 0 2px;
        background-color: #8e8e93;
        border-radius: 50%;
        display: inline-block;
        animation: typing 1.4s infinite ease-in-out;
      }
      
      .typing-indicator div:nth-child(1) { animation-delay: 0s; }
      .typing-indicator div:nth-child(2) { animation-delay: 0.2s; }
      .typing-indicator div:nth-child(3) { animation-delay: 0.4s; }
      
      @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-5px); }
      }
      
      .message {
        margin-bottom: 12px;
        padding: 10px 15px;
        border-radius: 18px;
        max-width: 80%;
        position: relative;
        line-height: 1.4;
        animation: fadeIn 0.3s ease;
      }

      .user-message {
        background: #1890ff;
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px;
      }

      .system-message {
        background: #f0f2f5;
        color: #1f1f1f;
        margin-right: auto;
        border-bottom-left-radius: 4px;
      }

      .message-content {
        word-wrap: break-word;
      }

      .message-time {
        font-size: 0.7rem;
        opacity: 0.7;
        margin-top: 4px;
        text-align: right;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .typing-indicator {
        display: flex;
        padding: 10px 15px;
        margin-bottom: 12px;
        background: #f0f2f5;
        border-radius: 18px;
        width: fit-content;
        max-width: 80%;
        border-bottom-left-radius: 4px;
      }
      
      .typing-indicator div {
        width: 8px;
        height: 8px;
        margin: 0 2px;
        background-color: #8e8e93;
        border-radius: 50%;
        display: inline-block;
        animation: typing 1.4s infinite ease-in-out;
      }
      
      .typing-indicator div:nth-child(1) { animation-delay: 0s; }
      .typing-indicator div:nth-child(2) { animation-delay: 0.2s; }
      .typing-indicator div:nth-child(3) { animation-delay: 0.4s; }
      
      @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-5px); }
      }
      .message {
        margin-bottom: 12px;
        padding: 10px 15px;
        border-radius: 18px;
        max-width: 80%;
        position: relative;
        line-height: 1.4;
        animation: fadeIn 0.3s ease;
      }

      .user-message {
        background: #1890ff;
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px;
      }

      .system-message {
        background: #f0f2f5;
        color: #1f1f1f;
        margin-right: auto;
        border-bottom-left-radius: 4px;
      }

      .message-content {
        word-wrap: break-word;
      }

      .message-time {
        font-size: 0.7rem;
        opacity: 0.7;
        margin-top: 4px;
        text-align: right;
      }

      /* Chat container animations */
      #chat-container {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Unread badge animation */
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }

      #chat-toggle div {
        animation: pulse 2s infinite;
        display: none;
      }

      /* Responsive styles */
      @media (max-width: 768px) {
        #chat-container {
          width: 100% !important;
          height: 100vh !important;
          right: 0 !important;
          left: auto !important;
          transform: translateX(100%) !important;
          border-radius: 0 !important;
        }
        
        #chat-toggle {
          width: 50px !important;
          height: 50px !important;
          border-radius: 50% !important;
          padding: 0 !important;
          right: 20px !important;
          bottom: 30px !important;
          top: auto !important;
          transform: none !important;
          box-shadow: 0 4px 12px rgba(24, 144, 255, 0.4) !important;
        }
        
        #chat-toggle span {
          display: none !important;
        }
        
        #chat-toggle svg {
          transform: rotate(0) !important;
          margin: 0 !important;
        }
        
        #chat-toggle .unread-badge {
          top: -5px !important;
          right: -5px !important;
        }
        
        .chat-visible {
          transform: translateY(0) !important;
          opacity: 1 !important;
          visibility: visible !important;
        }
      }
      
      @media (min-width: 769px) {
        #chat-toggle {
          display: block !important;
          bottom: 30px !important;
          right: 30px !important;
          width: 70px !important;
          height: 70px !important;
        }
        
        #chat-container {
          bottom: 30px !important;
          right: 30px !important;
        }
      }
      
      /* Custom scrollbar */
      #chat-messages::-webkit-scrollbar {
        width: 6px;
      }
      
      #chat-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      
      #chat-messages::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 10px;
      }
      
      #chat-messages::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }
    </style>
    <script>
      // Wait for DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize chat variables
        const chatContainer = document.getElementById('chat-container');
        const chatToggle = document.getElementById('chat-toggle');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const minimizeBtn = document.getElementById('minimize-chat');
        const closeBtn = document.getElementById('close-chat');
        const chatMessages = document.getElementById('chat-messages');
        
        // Initialize chat state
        let isChatOpen = false;
        let isChatVisible = false;
        
        // Toggle chat visibility on mobile
        function toggleChat() {
          isChatVisible = !isChatVisible;
          if (isChatVisible) {
            chatContainer.classList.add('chat-visible');
            chatInput.focus();
          } else {
            chatContainer.classList.remove('chat-visible');
          }
        }
        
        // Show chat
        function showChat() {
          isChatVisible = true;
          chatContainer.classList.add('chat-visible');
          chatInput.focus();
        }
        
        // Event listeners for chat controls
        chatToggle?.addEventListener('click', toggleChat);
        closeChatBtn?.addEventListener('click', () => {
          isChatVisible = false;
          chatContainer.classList.remove('chat-visible');
        });
        minimizeChatBtn?.addEventListener('click', () => {
          isChatVisible = false;
          chatContainer.classList.remove('chat-visible');
        });

        // Load and display existing messages
        function displayMessages() {
          const messages = window.chatStorage.loadMessages();
          chatMessages.innerHTML = ''; // Clear current messages
          
          if (messages.length === 0) {
            // Show welcome message for new chat
            chatMessages.innerHTML = `
              <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 20px; color: #666;">
                <div style="font-size: 1.5rem; margin-bottom: 10px; color: #1890ff;">ðŸ‘‹ Hello!</div>
                <p style="margin: 0 0 20px 0; max-width: 300px;">I'm your virtual assistant. How can I help you today?</p>
              </div>
            `;
            return;
          }
          
          messages.forEach(msg => {
            const messageDiv = document.createElement('div');
            messageDiv.style.margin = '8px 0';
            messageDiv.style.padding = '10px 14px';
            messageDiv.style.borderRadius = '12px';
            messageDiv.style.maxWidth = '85%';
            messageDiv.style.wordWrap = 'break-word';
            
            // Different styles for user and bot messages
            if (msg.sender === 'user') {
              messageDiv.style.marginLeft = 'auto';
              messageDiv.style.backgroundColor = '#1890ff';
              messageDiv.style.color = 'white';
              messageDiv.style.borderBottomRightRadius = '4px';
            } else {
              messageDiv.style.marginRight = 'auto';
              messageDiv.style.backgroundColor = '#f0f0f0';
              messageDiv.style.color = '#333';
              messageDiv.style.borderBottomLeftRadius = '4px';
            }
            
            messageDiv.innerHTML = `
              <div style="font-weight: 500; margin-bottom: 4px;">${msg.sender === 'user' ? 'You' : 'Assistant'}</div>
              <div style="white-space: pre-wrap;">${msg.text.replace(/\n/g, '<br>')}</div>
              <div style="font-size: 0.7rem; opacity: 0.8; text-align: right; margin-top: 4px;">
                ${new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
              </div>
            `;
            
            chatMessages.appendChild(messageDiv);
          });
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Add a new message to the chat
        function addMessage(sender, message, isSystem = false) {
          const messageObj = {
            id: Date.now(),
            sender,
            message,
            timestamp: new Date().toISOString(),
            isSystem
          };
          
          chatState.messages.push(messageObj);
          saveMessages();
          displayMessages();
          
          // Show unread badge if chat is closed or minimized
          if (!chatState.isVisible || chatState.isMinimized) {
            chatState.unreadCount++;
            if (unreadBadge) {
              unreadBadge.textContent = chatState.unreadCount > 9 ? '9+' : chatState.unreadCount;
              unreadBadge.style.display = 'flex';
            }
          }
          
          scrollToBottom();
        }

        // Send a new message
        function sendMessage() {
          if (!chatInput) return;
          
          const message = chatInput.value.trim();
          if (!message) return;
          
          // Add user message
          addMessage('user', message);
          
          // Clear input
          chatInput.value = '';
          
          // Show typing indicator
          const typingIndicator = document.createElement('div');
          typingIndicator.id = 'typing-indicator';
          typingIndicator.className = 'typing-indicator';
          typingIndicator.innerHTML = '<div></div><div></div><div></div>';
          if (chatMessages) {
            chatMessages.appendChild(typingIndicator);
            scrollToBottom();
          }
          
          // Simulate bot response after a short delay
          setTimeout(() => {
            // Remove typing indicator
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
              indicator.remove();
            }
            
            // Add bot response
            const responses = [
              "I understand your concern. Let me help you with that.",
              "Thanks for reaching out! How can I assist you today?",
              "I'll look into this and get back to you shortly.",
              "That's a great question! Let me find the best solution for you.",
              "I'm here to help. Could you provide more details?"
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addMessage('system', randomResponse, true);
          }, 1500);
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') sendMessage();
        });
        
        endChatBtn.addEventListener('click', () => {
          if (confirm('Are you sure you want to end this chat? All history will be cleared.')) {
            window.chatStorage.clearChat();
            chatMessages.innerHTML = `
              <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 20px; color: #666;">
                <div style="font-size: 1.2rem; margin-bottom: 10px;">Chat Ended</div>
                <p style="margin: 0 0 20px 0; max-width: 300px;">Thank you for chatting with us. Start a new conversation anytime!</p>
                <button id="start-new-chat" style="background: #1890ff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                  Start New Chat
                </button>
              </div>
            `;
            
            // Add event listener to the new chat button
            document.getElementById('start-new-chat')?.addEventListener('click', () => {
              window.chatStorage.clearChat();
              displayMessages();
            });
            
            // Hide chat on mobile after ending
            if (window.innerWidth < 769) {
              toggleChat();
            }
          }
        });

        // Initial display of messages
        displayMessages();
        
        // Toggle chat when clicking the footer bar
        isChatOpen = false;

        function toggleChat() {
          isChatOpen = !isChatOpen;
          if (isChatOpen) {
            chatContainer.style.transform = 'translateX(0)';
            chatToggle.style.right = '380px';
            chatToggle.style.boxShadow = 'none';
            document.getElementById('chat-input')?.focus();
          } else {
            chatContainer.style.transform = 'translateX(100%)';
            chatToggle.style.right = '0';
            chatToggle.style.boxShadow = '-2px 2px 12px rgba(0,0,0,0.15)';
          }
        }

        function showChat() {
          const chatContainer = document.getElementById('chat-container');
          chatContainer.style.transform = 'translateX(0)';
          chatToggle.style.right = '380px';
          chatToggle.style.boxShadow = 'none';
          document.getElementById('chat-input')?.focus();
          isChatOpen = true;
        }

        function hideChat() {
          const chatContainer = document.getElementById('chat-container');
          chatContainer.style.transform = 'translateX(100%)';
          chatToggle.style.right = '0';
          chatToggle.style.boxShadow = '-2px 2px 12px rgba(0,0,0,0.15)';
          isChatOpen = false;
        }

        chatToggle?.addEventListener('click', toggleChat);
        
        // Close chat when clicking close button
        document.getElementById('close-chat')?.addEventListener('click', () => {
          isChatOpen = false;
          chatContainer.style.height = '0';
          setTimeout(() => {
            chatToggle.style.opacity = '1';
            chatToggle.style.pointerEvents = 'auto';
          }, 300);
        });
      });
    </script>
  </body>
</html>
