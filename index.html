<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heritage Repository - Consent-Based Digital Archive</title>
    <meta
      name="description"
      content="Safeguarding Naga Heritage — Respectfully, Authentically, Together. A consent-based, tiered digital archive for traditional knowledge."
    />
    <meta name="author" content="Heritage Repository" />

    <meta
      property="og:title"
      content="Heritage Repository - Consent-Based Digital Archive"
    />
    <meta
      property="og:description"
      content="Safeguarding Naga Heritage — Respectfully, Authentically, Together."
    />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!-- BotPenguin Chatbot Integration -->
    <iframe src="https://page.botpenguin.com/69083c0a001f8cb23a75b118/690838f5cf30ddb349e703e5"></iframe>
    <!-- Chat Storage and UI -->
    <div id="chat-container" style="position: fixed; bottom: 20px; right: 20px; width: 300px; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; max-height: 500px;">
      <div style="background: #f5f5f5; padding: 10px; border-bottom: 1px solid #ddd; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0;">Chat</h3>
        <button id="end-chat-btn" style="background: #ff4d4f; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">End Chat</button>
      </div>
      <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 10px;">
        <!-- Messages will be inserted here -->
      </div>
      <div style="padding: 10px; border-top: 1px solid #ddd;">
        <input type="text" id="chat-input" style="width: calc(100% - 60px); padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Type a message...">
        <button id="send-btn" style="width: 50px; padding: 8px; margin-left: 5px;">Send</button>
      </div>
    </div>

    <!-- Chat Storage Script -->
    <script src="/chatStorage.js"></script>
    <script>
      // Wait for DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const endChatBtn = document.getElementById('end-chat-btn');

        // Load and display existing messages
        function displayMessages() {
          const messages = window.chatStorage.loadMessages();
          chatMessages.innerHTML = ''; // Clear current messages
          
          messages.forEach(msg => {
            const messageDiv = document.createElement('div');
            messageDiv.style.margin = '5px 0';
            messageDiv.style.padding = '8px';
            messageDiv.style.borderRadius = '4px';
            messageDiv.style.backgroundColor = msg.sender === 'user' ? '#e6f7ff' : '#f5f5f5';
            messageDiv.style.alignSelf = msg.sender === 'user' ? 'flex-end' : 'flex-start';
            messageDiv.style.maxWidth = '80%';
            
            messageDiv.innerHTML = `
              <div style="font-weight: bold;">${msg.sender === 'user' ? 'You' : 'Bot'}</div>
              <div>${msg.text}</div>
              <div style="font-size: 0.8em; color: #666; text-align: right;">
                ${new Date(msg.timestamp).toLocaleTimeString()}
              </div>
            `;
            
            chatMessages.appendChild(messageDiv);
          });
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Send message handler
        function sendMessage() {
          const message = chatInput.value.trim();
          if (message) {
            // Save user message
            window.chatStorage.saveMessage('user', message);
            chatInput.value = '';
            displayMessages();
            
            // Simulate bot response (replace with actual bot logic)
            setTimeout(() => {
              window.chatStorage.saveMessage('bot', 'Thanks for your message! This is an automated response.');
              displayMessages();
            }, 1000);
          }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') sendMessage();
        });
        
        endChatBtn.addEventListener('click', () => {
          if (confirm('Are you sure you want to end this chat? All history will be cleared.')) {
            window.chatStorage.clearChat();
            chatMessages.innerHTML = '<div style="padding: 10px; color: #666;">Chat cleared. Start a new conversation!</div>';
          }
        });

        // Initial display of messages
        displayMessages();
      });
    </script>
  </body>
</html>
