<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heritage Repository - Consent-Based Digital Archive</title>
    <meta
      name="description"
      content="Safeguarding Naga Heritage â€” Respectfully, Authentically, Together. A consent-based, tiered digital archive for traditional knowledge."
    />
    <meta name="author" content="Heritage Repository" />

    <meta
      property="og:title"
      content="Heritage Repository - Consent-Based Digital Archive"
    />
    <meta
      property="og:description"
      content="Safeguarding Naga Heritage â€” Respectfully, Authentically, Together."
    />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!-- Chat Toggle Button (Fixed at bottom) -->
    <div id="chat-toggle" style="position: fixed; bottom: 0; left: 0; right: 0; background: #1890ff; color: white; text-align: center; padding: 12px 0; cursor: pointer; z-index: 999; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;">
      <div style="display: flex; justify-content: center; align-items: center; gap: 8px;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));">
          <path d="M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span style="font-weight: 500; font-size: 0.95rem;">Need help? Chat with us</span>
      </div>
    </div>

    <!-- Chat Container -->
    <div id="chat-container" style="position: fixed; bottom: 0; left: 0; right: 0; height: 0; background: white; border-top: 1px solid #e0e0e0; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; z-index: 1000; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden;">
      <div style="background: #1890ff; color: white; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1);">
        <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600;">Chat with us</h3>
        <div>
          <button id="minimize-chat" style="background: transparent; border: none; color: white; font-size: 1.2rem; cursor: pointer; margin-right: 10px;">âˆ’</button>
          <button id="close-chat" style="background: transparent; border: none; color: white; font-size: 1.2rem; cursor: pointer;">Ã—</button>
        </div>
      </div>
      <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 16px; background: #f8f9fa; scrollbar-width: thin; scrollbar-color: #c1c1c1 #f1f1f1;">
        <!-- Messages will be inserted here -->
      </div>
      <div style="padding: 12px 16px; background: white; border-top: 1px solid #f0f0f0;">
        <div style="display: flex; gap: 8px;">
          <input 
            type="text" 
            id="chat-input" 
            style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; font-size: 0.95rem;" 
            placeholder="Type a message..."
            autocomplete="off"
          >
          <button id="send-btn" style="background: #1890ff; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div style="margin-top: 10px; text-align: center;">
          <button id="end-chat-btn" style="background: #ff4d4f; color: white; border: none; padding: 6px 12px; border-radius: 15px; font-size: 0.85rem; cursor: pointer; display: inline-flex; align-items: center; gap: 4px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            End Chat
          </button>
        </div>
      </div>
    </div>

    <!-- Chat Storage Script -->
    <script src="/chatStorage.js"></script>
    <style>
      /* Responsive styles */
      @media (max-width: 768px) {
        #chat-container {
          width: 90% !important;
          height: 80vh !important;
          right: 5% !important;
          bottom: 5% !important;
          max-height: 90vh !important;
        }
        
        #chat-toggle {
          display: block !important;
          bottom: 20px !important;
          right: 20px !important;
        }
        
        .chat-visible {
          transform: translateY(0) !important;
          opacity: 1 !important;
          visibility: visible !important;
        }
      }
      
      @media (min-width: 769px) {
        #chat-toggle {
          display: block !important;
          bottom: 30px !important;
          right: 30px !important;
          width: 70px !important;
          height: 70px !important;
        }
        
        #chat-container {
          bottom: 30px !important;
          right: 30px !important;
        }
      }
      
      /* Custom scrollbar */
      #chat-messages::-webkit-scrollbar {
        width: 6px;
      }
      
      #chat-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      
      #chat-messages::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 10px;
      }
      
      #chat-messages::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }
    </style>
    <script>
      // Wait for DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        const chatContainer = document.getElementById('chat-container');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const endChatBtn = document.getElementById('end-chat-btn');
        const chatToggle = document.getElementById('chat-toggle');
        const closeChatBtn = document.getElementById('close-chat');
        const minimizeChatBtn = document.getElementById('minimize-chat');
        let isChatVisible = false;
        
        // Toggle chat visibility on mobile
        function toggleChat() {
          isChatVisible = !isChatVisible;
          if (isChatVisible) {
            chatContainer.classList.add('chat-visible');
            chatInput.focus();
          } else {
            chatContainer.classList.remove('chat-visible');
          }
        }
        
        // Show chat
        function showChat() {
          isChatVisible = true;
          chatContainer.classList.add('chat-visible');
          chatInput.focus();
        }
        
        // Event listeners for chat controls
        chatToggle?.addEventListener('click', toggleChat);
        closeChatBtn?.addEventListener('click', () => {
          isChatVisible = false;
          chatContainer.classList.remove('chat-visible');
        });
        minimizeChatBtn?.addEventListener('click', () => {
          isChatVisible = false;
          chatContainer.classList.remove('chat-visible');
        });

        // Load and display existing messages
        function displayMessages() {
          const messages = window.chatStorage.loadMessages();
          chatMessages.innerHTML = ''; // Clear current messages
          
          if (messages.length === 0) {
            // Show welcome message for new chat
            chatMessages.innerHTML = `
              <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 20px; color: #666;">
                <div style="font-size: 1.5rem; margin-bottom: 10px; color: #1890ff;">ðŸ‘‹ Hello!</div>
                <p style="margin: 0 0 20px 0; max-width: 300px;">I'm your virtual assistant. How can I help you today?</p>
              </div>
            `;
            return;
          }
          
          messages.forEach(msg => {
            const messageDiv = document.createElement('div');
            messageDiv.style.margin = '8px 0';
            messageDiv.style.padding = '10px 14px';
            messageDiv.style.borderRadius = '12px';
            messageDiv.style.maxWidth = '85%';
            messageDiv.style.wordWrap = 'break-word';
            
            // Different styles for user and bot messages
            if (msg.sender === 'user') {
              messageDiv.style.marginLeft = 'auto';
              messageDiv.style.backgroundColor = '#1890ff';
              messageDiv.style.color = 'white';
              messageDiv.style.borderBottomRightRadius = '4px';
            } else {
              messageDiv.style.marginRight = 'auto';
              messageDiv.style.backgroundColor = '#f0f0f0';
              messageDiv.style.color = '#333';
              messageDiv.style.borderBottomLeftRadius = '4px';
            }
            
            messageDiv.innerHTML = `
              <div style="font-weight: 500; margin-bottom: 4px;">${msg.sender === 'user' ? 'You' : 'Assistant'}</div>
              <div style="white-space: pre-wrap;">${msg.text.replace(/\n/g, '<br>')}</div>
              <div style="font-size: 0.7rem; opacity: 0.8; text-align: right; margin-top: 4px;">
                ${new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
              </div>
            `;
            
            chatMessages.appendChild(messageDiv);
          });
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Send message handler
        function sendMessage() {
          const message = chatInput.value.trim();
          if (message) {
            // Save user message
            window.chatStorage.saveMessage('user', message);
            chatInput.value = '';
            displayMessages();
            
            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.id = 'typing-indicator';
            typingIndicator.style.display = 'flex';
            typingIndicator.style.gap = '5px';
            typingIndicator.style.margin = '5px 0';
            typingIndicator.style.padding = '8px';
            typingIndicator.style.backgroundColor = '#f5f5f5';
            typingIndicator.style.borderRadius = '4px';
            typingIndicator.style.alignSelf = 'flex-start';
            typingIndicator.innerHTML = `
              <div style="width: 8px; height: 8px; background: #999; border-radius: 50%; animation: bounce 1s infinite;"></div>
              <div style="width: 8px; height: 8px; background: #999; border-radius: 50%; animation: bounce 1s infinite 0.2s;"></div>
              <div style="width: 8px; height: 8px; background: #999; border-radius: 50%; animation: bounce 1s infinite 0.4s;"></div>
              <style>
                @keyframes bounce {
                  0%, 100% { transform: translateY(0); }
                  50% { transform: translateY(-5px); }
                }
              </style>
            `;
            chatMessages.appendChild(typingIndicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Simulate bot response (replace with actual bot API call)
            setTimeout(() => {
              // Remove typing indicator
              const indicator = document.getElementById('typing-indicator');
              if (indicator) indicator.remove();
              
              // Save and display bot response
              window.chatStorage.saveMessage('bot', 'Thanks for your message! This is an automated response.');
              displayMessages();
            }, 1500);
          }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') sendMessage();
        });
        
        endChatBtn.addEventListener('click', () => {
          if (confirm('Are you sure you want to end this chat? All history will be cleared.')) {
            window.chatStorage.clearChat();
            chatMessages.innerHTML = `
              <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 20px; color: #666;">
                <div style="font-size: 1.2rem; margin-bottom: 10px;">Chat Ended</div>
                <p style="margin: 0 0 20px 0; max-width: 300px;">Thank you for chatting with us. Start a new conversation anytime!</p>
                <button id="start-new-chat" style="background: #1890ff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                  Start New Chat
                </button>
              </div>
            `;
            
            // Add event listener to the new chat button
            document.getElementById('start-new-chat')?.addEventListener('click', () => {
              window.chatStorage.clearChat();
              displayMessages();
            });
            
            // Hide chat on mobile after ending
            if (window.innerWidth < 769) {
              toggleChat();
            }
          }
        });

        // Initial display of messages
        displayMessages();
        
        // Toggle chat when clicking the footer bar
        const chatToggle = document.getElementById('chat-toggle');
        const chatContainer = document.getElementById('chat-container');
        let isChatOpen = false;

        function toggleChat() {
          isChatOpen = !isChatOpen;
          if (isChatOpen) {
            chatContainer.style.height = '400px';
            chatToggle.style.opacity = '0';
            chatToggle.style.pointerEvents = 'none';
          } else {
            chatContainer.style.height = '0';
            setTimeout(() => {
              chatToggle.style.opacity = '1';
              chatToggle.style.pointerEvents = 'auto';
            }, 300);
          }
        }

        function showChat() {
          const chatContainer = document.getElementById('chat-container');
          chatContainer.style.height = '400px';
          document.getElementById('chat-input')?.focus();
        }

        function hideChat() {
          const chatContainer = document.getElementById('chat-container');
          chatContainer.style.height = '0';
          const chatToggle = document.getElementById('chat-toggle');
          chatToggle.style.opacity = '1';
          chatToggle.style.pointerEvents = 'auto';
        }

        chatToggle?.addEventListener('click', toggleChat);
        
        // Close chat when clicking close button
        document.getElementById('close-chat')?.addEventListener('click', () => {
          isChatOpen = false;
          chatContainer.style.height = '0';
          setTimeout(() => {
            chatToggle.style.opacity = '1';
            chatToggle.style.pointerEvents = 'auto';
          }, 300);
        });
      });
    </script>
  </body>
</html>
